var V=Object.defineProperty;var Y=(i,e,r)=>e in i?V(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r;var p=(i,e,r)=>(Y(i,typeof e!="symbol"?e+"":e,r),r);import{S as C,i as E,s as O,e as f,t as S,a as y,b as k,c as b,d as u,f as A,l as v,g as G,n as _,h as q,r as R,j,k as F,m as I,o as J,p as d,q as h,u as W,v as Q,w as N,P as X,x as Z,y as $,z as T}from"./vendor.fd7ae926.js";const x=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};x();function ee(i){let e,r,t,n,s,o,c,l,w,a,L,z;return{c(){e=f("div"),r=f("div"),t=S("Your peer id is "),n=S(i[0]),s=y(),o=f("label"),c=S("Connect to "),l=f("input"),w=y(),a=f("button"),a.textContent="Connect",k(l,"type","text"),k(e,"class","container")},m(m,g){b(m,e,g),u(e,r),u(r,t),u(r,n),u(e,s),u(e,o),u(o,c),u(o,l),A(l,i[1]),u(e,w),u(e,a),L||(z=[v(l,"input",i[5]),v(a,"click",i[6])],L=!0)},p(m,[g]){g&1&&G(n,m[0]),g&2&&l.value!==m[1]&&A(l,m[1])},i:_,o:_,d(m){m&&q(e),L=!1,R(z)}}}function ne(i,e,r){let{id:t}=e,{peer:n}=e,{connection:s}=e,o="";function c(){let a=n.connect(o,{reliable:!0,serialization:"binary"});a.on("open",()=>r(3,s=a))}function l(){o=this.value,r(1,o)}const w=()=>c();return i.$$set=a=>{"id"in a&&r(0,t=a.id),"peer"in a&&r(4,n=a.peer),"connection"in a&&r(3,s=a.connection)},[t,o,c,s,n,l,w]}class te extends C{constructor(e){super();E(this,e,ne,ee,O,{id:0,peer:4,connection:3})}}const P=5*1024*1024;function B(i){return Math.ceil(i/P)}async function oe(i,e,r){const t=r!=null?r:B(i.size);if(e>=t)throw new Error("Chunk out of bounds");return e!==t-1?await i.slice(e*P,(e+1)*P).arrayBuffer():await i.slice(e*P).arrayBuffer()}async function*re(i){const e=B(i.size);for(let r=0;r<e;r++)yield await oe(i,r,e)}let D=Promise.resolve();async function H(){await D;let i={};return D=i.promise=new Promise(e=>i.releaseLock=e),i}j.mitm="https://vigneshpa.github.io/stream-saver-mitm/";class se{constructor(e){p(this,"reqres");p(this,"streamPull");this.connection=e,this.reqres=new ie(e,this.requestHandler.bind(this)),this.streamPull=null}async requestHandler(e){if(e==="stream-pull"){if(!this.streamPull)throw new Error("Currently not streaming");return await this.streamPull()}if(e.filename){const{filename:r,size:t}=e;if(!confirm(`Do you want to download
`+r))return"canceled";const n=this,s=new ReadableStream({async pull(c){const l=await n.reqres.request("stream-pull");l==="stop"?c.close():c.enqueue(new Uint8Array(l))}}),o=j.createWriteStream(r,{size:t});return s.pipeTo(o),"accepted"}}async sendFile(e){if(this.streamPull)throw new Error("Already streaming another file");if(await this.reqres.request({filename:e.name,size:e.size})==="accepted"){const t=re(e);this.streamPull=async()=>{const{value:n,done:s}=await t.next();if(n)return n;if(s)return this.streamPull=null,"stop";throw new Error("No value got")}}}}class ie{constructor(e,r){p(this,"connection");p(this,"resolver");p(this,"request");console.log("Attaching reqres handler to ",e),this.connection=e,this.resolver=null,this.connection.on("data",async t=>{if(console.log(t),t.response&&this.resolver(t.message),t.request){console.log("Locked for request",t.message);const n=await H(),s=await r(t.message);this.connection.send({response:!0,message:s}),n.releaseLock()}}),this.request=async t=>{console.log("Locked for request",t);const n=await H();return new Promise(s=>{this.connection.send({request:!0,message:t}),this.resolver=o=>{n.releaseLock(),s(o)}})}}}function ce(i){let e,r,t,n,s,o;return{c(){e=f("div"),r=f("input"),t=y(),n=f("button"),n.textContent="Send",k(r,"type","file"),r.multiple=!0,k(e,"class","container")},m(c,l){b(c,e,l),u(e,r),u(e,t),u(e,n),s||(o=[v(r,"change",i[3]),v(n,"click",i[1])],s=!0)},p:_,i:_,o:_,d(c){c&&q(e),s=!1,R(o)}}}function le(i,e,r){let{connection:t}=e,n;const s=new se(t);async function o(){for(let l of n)s.sendFile(l)}function c(){n=this.files,r(0,n)}return i.$$set=l=>{"connection"in l&&r(2,t=l.connection)},[n,o,t,c]}class ae extends C{constructor(e){super();E(this,e,le,ce,O,{connection:2})}}function M(i){let e,r,t;function n(o){i[3](o)}let s={peer:i[0],id:i[1]};return i[2]!==void 0&&(s.connection=i[2]),e=new te({props:s}),Z.push(()=>$(e,"connection",n)),{c(){F(e.$$.fragment)},m(o,c){I(e,o,c),t=!0},p(o,c){const l={};c&1&&(l.peer=o[0]),c&2&&(l.id=o[1]),!r&&c&4&&(r=!0,l.connection=o[2],J(()=>r=!1)),e.$set(l)},i(o){t||(d(e.$$.fragment,o),t=!0)},o(o){h(e.$$.fragment,o),t=!1},d(o){W(e,o)}}}function K(i){let e,r;return e=new ae({props:{connection:i[2]}}),{c(){F(e.$$.fragment)},m(t,n){I(e,t,n),r=!0},p(t,n){const s={};n&4&&(s.connection=t[2]),e.$set(s)},i(t){r||(d(e.$$.fragment,t),r=!0)},o(t){h(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function ue(i){let e,r,t,n=!i[2]&&i[1]&&M(i),s=i[2]&&K(i);return{c(){n&&n.c(),e=y(),s&&s.c(),r=Q()},m(o,c){n&&n.m(o,c),b(o,e,c),s&&s.m(o,c),b(o,r,c),t=!0},p(o,[c]){!o[2]&&o[1]?n?(n.p(o,c),c&6&&d(n,1)):(n=M(o),n.c(),d(n,1),n.m(e.parentNode,e)):n&&(T(),h(n,1,1,()=>{n=null}),N()),o[2]?s?(s.p(o,c),c&4&&d(s,1)):(s=K(o),s.c(),d(s,1),s.m(r.parentNode,r)):s&&(T(),h(s,1,1,()=>{s=null}),N())},i(o){t||(d(n),d(s),t=!0)},o(o){h(n),h(s),t=!1},d(o){n&&n.d(o),o&&q(e),s&&s.d(o),o&&q(r)}}}function fe(i,e,r){let t;t=new X;let n="";t.on("open",c=>console.log(r(1,n=c)));let s;t.on("connection",c=>c.on("open",()=>r(2,s=c))),window.addEventListener("beforeunload",c=>t.destroy()),t.on("error",c=>console.error(c));function o(c){s=c,r(2,s)}return[t,n,s,o]}class de extends C{constructor(e){super();E(this,e,fe,ue,O,{})}}const me="modulepreload",U={},pe="/peer-share/",he=function(e,r){return!r||r.length===0?e():Promise.all(r.map(t=>{if(t=`${pe}${t}`,t in U)return;U[t]=!0;const n=t.endsWith(".css"),s=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const o=document.createElement("link");if(o.rel=n?"stylesheet":me,n||(o.as="script",o.crossOrigin=""),o.href=t,document.head.appendChild(o),n)return new Promise((c,l)=>{o.addEventListener("load",c),o.addEventListener("error",l)})})).then(()=>e())};async function _e(){if(!window.WritableStream){const i=await he(()=>import("./ponyfill.es2018.3a0cf7e4.js"),[]);for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&(window[e]=i[e])}}function we(){window.app=new de({target:document.body})}_e().then(we);
