var fe=Object.defineProperty;var de=(n,e,t)=>e in n?fe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var z=(n,e,t)=>(de(n,typeof e!="symbol"?e+"":e,t),t);import{S as I,i as W,s as D,e as p,t as q,a as b,b as _,c as S,d as c,f as Q,l as E,g as Y,n as j,h as M,r as X,w as pe,j as he,k as $,m as me,o as _e,p as x,q as ee,u as ve,v as P,x as O,y as te,z as we,A as ne,P as be,B as ge,C as ke,D as oe}from"./vendor.35b18366.js";const ye=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=t(l);fetch(l.href,s)}};ye();function Ce(n){let e,t,o,l,s,i,a,r,u,f,h,v,d,k,B,m,y;return{c(){e=p("div"),t=p("div"),o=q("Your peer id is "),l=q(n[0]),s=b(),i=p("div"),a=p("a"),r=q("Share this link to others to connect"),f=b(),h=p("label"),v=q("Connect to "),d=p("input"),k=b(),B=p("button"),B.textContent="Connect",_(a,"href",u="#"+n[0]),_(a,"target","_blank"),_(d,"type","text"),_(e,"class","container")},m(w,g){S(w,e,g),c(e,t),c(t,o),c(t,l),c(e,s),c(e,i),c(i,a),c(a,r),c(e,f),c(e,h),c(h,v),c(h,d),Q(d,n[1]),c(e,k),c(e,B),m||(y=[E(d,"input",n[5]),E(B,"click",n[6])],m=!0)},p(w,[g]){g&1&&Y(l,w[0]),g&1&&u!==(u="#"+w[0])&&_(a,"href",u),g&2&&d.value!==w[1]&&Q(d,w[1])},i:j,o:j,d(w){w&&M(e),m=!1,X(y)}}}function qe(n,e,t){let{id:o}=e,{peer:l}=e,{connection:s}=e,i="";function a(f){f&&t(1,i=f);let h=l.connect(i,{reliable:!0,serialization:"binary"});h.on("open",()=>t(3,s=h)),history.replaceState(null,document.title,window.location.pathname)}if(window.location.hash){const f=window.location.hash.substring(1);f&&a(f)}function r(){i=this.value,t(1,i)}const u=()=>a();return n.$$set=f=>{"id"in f&&t(0,o=f.id),"peer"in f&&t(4,l=f.peer),"connection"in f&&t(3,s=f.connection)},[o,i,a,s,l,r,u]}class Pe extends I{constructor(e){super();W(this,e,qe,Ce,D,{id:0,peer:4,connection:3})}}const F=pe(5*1024*1024);let se=5*1024*1024;F.subscribe(n=>se=n);async function Be(n,e){const t=e;return e+=se,e>=n.size&&(e=n.size),{chunkFrom:e,value:await n.slice(t,e).arrayBuffer()}}async function*Le(n){for(let e=0;e<n.size;){const{value:t,chunkFrom:o}=await Be(n,e);e=o,yield t}}let ie=Promise.resolve();async function re(){await ie;let n={};return ie=n.promise=new Promise(e=>n.releaseLock=e),n}function ze(n,e){const t=document.createElement("a");t.hidden=!0;const o=URL.createObjectURL(e);t.href=o,t.download=n,document.body.append(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(o))}function A(n,e=!1,t=1){const o=e?1e3:1024;if(Math.abs(n)<o)return n+" B";const l=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let s=-1;const i=10**t;do n/=o,++s;while(Math.round(Math.abs(n)*i)/i>=o&&s<l.length-1);return n.toFixed(t)+" "+l[s]}class Se{constructor(e,t=o=>{}){z(this,"reqres");z(this,"requestCancel");z(this,"streamPull");this.connection=e,this.progressHandler=t,e.on("close",()=>this.requestCancel=!0),this.reqres=new Ee(e,this.requestHandler.bind(this)),this.streamPull=null,this.requestCancel=!1}cancel(e){this.streamPull?this.requestCancel=!0:e||this.reqres.request("stream-cancel")}async requestHandler(e){if(e==="stream-pull"){if(!this.streamPull)throw new Error("Currently not streaming");return await this.streamPull(this.requestCancel)}else{if(e==="stream-cancel")return this.cancel(!0),"canceled";if(e.filename){const{filename:t,size:o}=e;if(!confirm(`Do you want to download
`+t))return"canceled";const l=this;let s=0;const i=new ReadableStream({async pull(r){const u=await l.reqres.request("stream-pull");u==="stop"?r.close():u==="canceled"?r.error():(r.enqueue(new Uint8Array(u)),s+=u.byteLength,l.progressHandler({loaded:s,total:o}))}});return new Response(i).blob().then(r=>ze(t,r)),"accepted"}}}sendFile(e){return new Promise(async t=>{if(this.streamPull)throw new Error("Already streaming another file");const o=await this.reqres.request({filename:e.name,size:e.size});let l=0;if(o==="accepted"){const s=Le(e);this.streamPull=async i=>{if(i)return this.requestCancel=!1,this.streamPull=null,t(),"canceled";const{value:a,done:r}=await s.next();if(a)return l+=a.byteLength,this.progressHandler({loaded:l,total:e.size}),a;if(r)return this.streamPull=null,t(),"stop";throw new Error("No value got")}}})}}class Ee{constructor(e,t){z(this,"connection");z(this,"resolver");z(this,"request");this.connection=e,this.resolver=null,this.connection.on("data",async o=>{if(o.response&&this.resolver(o.message),o.request){const l=await re(),s=await t(o.message);this.connection.send({response:!0,message:s}),l.releaseLock()}}),this.request=async o=>{const l=await re();return new Promise(s=>{this.connection.send({request:!0,message:o}),this.resolver=i=>{l.releaseLock(),s(i)}})}}}function Me(n){let e,t,o,l,s,i,a,r,u,f,h,v,d,k,B,m,y,w,g=A(n[1])+"",H,G,R=A(n[2])+"",T,K,Z,V,N,U,J;return{c(){e=p("div"),t=p("div"),o=p("input"),l=b(),s=p("button"),s.textContent="Send",i=b(),a=p("div"),r=p("label"),u=q("Chunk Size : "),f=p("select"),h=p("option"),h.textContent="1MB",v=p("option"),v.textContent="5MB",d=p("option"),d.textContent="10MB",k=p("option"),k.textContent="25MB",B=b(),m=p("div"),y=p("progress"),w=b(),H=q(g),G=q(" of "),T=q(R),K=b(),Z=p("br"),V=b(),N=p("button"),N.textContent="Cancel",_(o,"type","file"),o.multiple=!0,_(t,"class","svelte-hiwvhv"),h.__value=1*1024*1024,h.value=h.__value,v.__value=5*1024*1024,v.value=v.__value,d.__value=10*1024*1024,d.value=d.__value,k.__value=25*1024*1024,k.value=k.__value,n[3]===void 0&&he(()=>n[8].call(f)),_(a,"class","svelte-hiwvhv"),y.value=n[1],_(y,"max",n[2]),_(m,"class","svelte-hiwvhv"),_(e,"class","container svelte-hiwvhv")},m(C,L){S(C,e,L),c(e,t),c(t,o),c(t,l),c(t,s),c(e,i),c(e,a),c(a,r),c(r,u),c(r,f),c(f,h),c(f,v),c(f,d),c(f,k),$(f,n[3]),c(e,B),c(e,m),c(m,y),c(m,w),c(m,H),c(m,G),c(m,T),c(m,K),c(m,Z),c(m,V),c(m,N),U||(J=[E(o,"change",n[7]),E(s,"click",n[5]),E(f,"change",n[8]),E(N,"click",n[9])],U=!0)},p(C,[L]){L&8&&$(f,C[3]),L&2&&(y.value=C[1]),L&4&&_(y,"max",C[2]),L&2&&g!==(g=A(C[1])+"")&&Y(H,g),L&4&&R!==(R=A(C[2])+"")&&Y(T,R)},i:j,o:j,d(C){C&&M(e),U=!1,X(J)}}}function Oe(n,e,t){let o;me(n,F,d=>t(3,o=d));let{connection:l}=e,s,i=0,a=100;const r=new Se(l,d=>t(1,{loaded:i,total:a}=d,i,t(2,a)));async function u(){for(let d of s)await r.sendFile(d)}function f(){s=this.files,t(0,s)}function h(){o=_e(this),F.set(o)}const v=()=>r.cancel();return n.$$set=d=>{"connection"in d&&t(6,l=d.connection)},[s,i,a,o,r,u,l,f,h,v]}class Re extends I{constructor(e){super();W(this,e,Oe,Me,D,{connection:6})}}function le(n){let e,t,o;function l(i){n[4](i)}let s={peer:n[1],id:n[2]};return n[0]!==void 0&&(s.connection=n[0]),e=new Pe({props:s}),ge.push(()=>ke(e,"connection",l)),{c(){x(e.$$.fragment)},m(i,a){ee(e,i,a),o=!0},p(i,a){const r={};a&2&&(r.peer=i[1]),a&4&&(r.id=i[2]),!t&&a&1&&(t=!0,r.connection=i[0],ve(()=>t=!1)),e.$set(r)},i(i){o||(P(e.$$.fragment,i),o=!0)},o(i){O(e.$$.fragment,i),o=!1},d(i){te(e,i)}}}function ae(n){let e,t;return e=new Re({props:{connection:n[0]}}),{c(){x(e.$$.fragment)},m(o,l){ee(e,o,l),t=!0},p(o,l){const s={};l&1&&(s.connection=o[0]),e.$set(s)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){O(e.$$.fragment,o),t=!1},d(o){te(e,o)}}}function ce(n){let e;return{c(){e=p("div"),e.textContent="Peer to Peer Connection to remote person is closed"},m(t,o){S(t,e,o)},d(t){t&&M(e)}}}function Ne(n){let e,t,o,l,s=!n[0]&&n[2]&&le(n),i=n[0]&&!n[3]&&ae(n),a=n[3]&&ce();return{c(){s&&s.c(),e=b(),i&&i.c(),t=b(),a&&a.c(),o=we()},m(r,u){s&&s.m(r,u),S(r,e,u),i&&i.m(r,u),S(r,t,u),a&&a.m(r,u),S(r,o,u),l=!0},p(r,[u]){!r[0]&&r[2]?s?(s.p(r,u),u&5&&P(s,1)):(s=le(r),s.c(),P(s,1),s.m(e.parentNode,e)):s&&(oe(),O(s,1,1,()=>{s=null}),ne()),r[0]&&!r[3]?i?(i.p(r,u),u&9&&P(i,1)):(i=ae(r),i.c(),P(i,1),i.m(t.parentNode,t)):i&&(oe(),O(i,1,1,()=>{i=null}),ne()),r[3]?a||(a=ce(),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},i(r){l||(P(s),P(i),l=!0)},o(r){O(s),O(i),l=!1},d(r){s&&s.d(r),r&&M(e),i&&i.d(r),r&&M(t),a&&a.d(r),r&&M(o)}}}function je(n,e,t){let o;o=new be;let l="";o.on("open",r=>console.log(t(2,l=r)));let s=null,i=!1;o.on("connection",r=>r.on("open",()=>t(0,s=r))),window.addEventListener("beforeunload",r=>{s&&s.close(),o.destroy()}),o.on("error",r=>console.error(r));function a(r){s=r,t(0,s)}return n.$$.update=()=>{n.$$.dirty&1&&s&&s.on("close",()=>t(3,i=!0))},[s,o,l,i,a]}class Ae extends I{constructor(e){super();W(this,e,je,Ne,D,{})}}const He="modulepreload",ue={},Te="/peer-share/",Ue=function(e,t){return!t||t.length===0?e():Promise.all(t.map(o=>{if(o=`${Te}${o}`,o in ue)return;ue[o]=!0;const l=o.endsWith(".css"),s=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${s}`))return;const i=document.createElement("link");if(i.rel=l?"stylesheet":He,l||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),l)return new Promise((a,r)=>{i.addEventListener("load",a),i.addEventListener("error",r)})})).then(()=>e())};async function Ie(){if(!window.WritableStream){const n=await Ue(()=>import("./ponyfill.es2018.3a0cf7e4.js"),[]);for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(window[e]=n[e])}}function We(){window.app=new Ae({target:document.body})}Ie().then(We);
