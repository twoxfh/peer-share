var K=Object.defineProperty;var M=(s,e,o)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var k=(s,e,o)=>(M(s,typeof e!="symbol"?e+"":e,o),o);import{S as C,i as E,s as P,e as u,t as O,a as w,b,c as y,d as f,f as F,l as v,g as V,n as h,h as S,r as z,j as A,k as N,m as R,o as Y,p as d,q as p,u as T,v as B,w as j,P as G,x as H,y as J,z as W}from"./vendor.fd7ae926.js";const Q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&r(t)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}};Q();function X(s){let e,o,r,n,i,t,c,l,_,a,L,q;return{c(){e=u("div"),o=u("div"),r=O("Your peer id is "),n=O(s[0]),i=w(),t=u("label"),c=O("Connect to "),l=u("input"),_=w(),a=u("button"),a.textContent="Connect",b(l,"type","text"),b(e,"class","container")},m(m,g){y(m,e,g),f(e,o),f(o,r),f(o,n),f(e,i),f(e,t),f(t,c),f(t,l),F(l,s[1]),f(e,_),f(e,a),L||(q=[v(l,"input",s[5]),v(a,"click",s[6])],L=!0)},p(m,[g]){g&1&&V(n,m[0]),g&2&&l.value!==m[1]&&F(l,m[1])},i:h,o:h,d(m){m&&S(e),L=!1,z(q)}}}function Z(s,e,o){let{id:r}=e,{peer:n}=e,{connection:i}=e,t="";function c(){let a=n.connect(t,{reliable:!0,serialization:"binary"});a.on("open",()=>o(3,i=a))}function l(){t=this.value,o(1,t)}const _=()=>c();return s.$$set=a=>{"id"in a&&o(0,r=a.id),"peer"in a&&o(4,n=a.peer),"connection"in a&&o(3,i=a.connection)},[r,t,c,i,n,l,_]}class $ extends C{constructor(e){super();E(this,e,Z,X,P,{id:0,peer:4,connection:3})}}A.mitm="https://vigneshpa.github.io/stream-saver-mitm/";class x{constructor(e){k(this,"connection");k(this,"locked");k(this,"ondata");this.locked=!1,this.ondata=()=>{},e.on("data",o=>{if(this.ondata(o),console.log(o,typeof o),o.downloadFile){this.lock();const{filename:r,size:n}=o;console.log("Recived request to download file",r);const i=this.getStream(),t=A.createWriteStream(r,{size:n});i.pipeTo(t)}}),this.connection=e}lock(){if(this.locked)throw new Error("This connection is locked");this.locked=!0}releaseLock(){if(!this.locked)throw new Error("Cannot release a unlocked connection");this.ondata=()=>{},this.locked=!1}sendFile(e){this.lock(),this.ondata=async o=>{if(o==="stream-get-start"){console.log("Starting to read from source");const r=e.stream().getReader();for(;;){const{done:n,value:i}=await r.read();if(i&&this.connection.send(new Uint8Array(i).buffer),n){this.connection.send("stop"),this.releaseLock();break}}}},this.connection.send({downloadFile:!0,filename:e.name,size:e.size})}getStream(){const e=this;return new ReadableStream({start(o){e.ondata=r=>{typeof r=="string"?r==="error"?o.error():r==="stop"&&(setTimeout(()=>o.close(),1e3),e.releaseLock()):o.enqueue(new Uint8Array(r))},e.connection.send("stream-get-start")}})}}function ee(s){let e,o,r,n,i,t;return{c(){e=u("div"),o=u("input"),r=w(),n=u("button"),n.textContent="Send",b(o,"type","file"),o.multiple=!0,b(e,"class","container")},m(c,l){y(c,e,l),f(e,o),f(e,r),f(e,n),i||(t=[v(o,"change",s[3]),v(n,"click",s[1])],i=!0)},p:h,i:h,o:h,d(c){c&&S(e),i=!1,z(t)}}}function ne(s,e,o){let{connection:r}=e,n;const i=new x(r);async function t(){for(let l of n)i.sendFile(l),alert("Sent file "+l.name)}function c(){n=this.files,o(0,n)}return s.$$set=l=>{"connection"in l&&o(2,r=l.connection)},[n,t,r,c]}class te extends C{constructor(e){super();E(this,e,ne,ee,P,{connection:2})}}function I(s){let e,o,r;function n(t){s[3](t)}let i={peer:s[0],id:s[1]};return s[2]!==void 0&&(i.connection=s[2]),e=new $({props:i}),H.push(()=>J(e,"connection",n)),{c(){N(e.$$.fragment)},m(t,c){R(e,t,c),r=!0},p(t,c){const l={};c&1&&(l.peer=t[0]),c&2&&(l.id=t[1]),!o&&c&4&&(o=!0,l.connection=t[2],Y(()=>o=!1)),e.$set(l)},i(t){r||(d(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){T(e,t)}}}function U(s){let e,o;return e=new te({props:{connection:s[2]}}),{c(){N(e.$$.fragment)},m(r,n){R(e,r,n),o=!0},p(r,n){const i={};n&4&&(i.connection=r[2]),e.$set(i)},i(r){o||(d(e.$$.fragment,r),o=!0)},o(r){p(e.$$.fragment,r),o=!1},d(r){T(e,r)}}}function oe(s){let e,o,r,n=!s[2]&&s[1]&&I(s),i=s[2]&&U(s);return{c(){n&&n.c(),e=w(),i&&i.c(),o=B()},m(t,c){n&&n.m(t,c),y(t,e,c),i&&i.m(t,c),y(t,o,c),r=!0},p(t,[c]){!t[2]&&t[1]?n?(n.p(t,c),c&6&&d(n,1)):(n=I(t),n.c(),d(n,1),n.m(e.parentNode,e)):n&&(W(),p(n,1,1,()=>{n=null}),j()),t[2]?i?(i.p(t,c),c&4&&d(i,1)):(i=U(t),i.c(),d(i,1),i.m(o.parentNode,o)):i&&(W(),p(i,1,1,()=>{i=null}),j())},i(t){r||(d(n),d(i),r=!0)},o(t){p(n),p(i),r=!1},d(t){n&&n.d(t),t&&S(e),i&&i.d(t),t&&S(o)}}}function ie(s,e,o){let r;r=new G;let n="";r.on("open",c=>console.log(o(1,n=c)));let i;r.on("connection",c=>{console.log(c),c.on("open",()=>o(2,i=c))}),window.addEventListener("beforeunload",c=>r.destroy()),r.on("error",c=>console.error(c));function t(c){i=c,o(2,i)}return[r,n,i,t]}class re extends C{constructor(e){super();E(this,e,ie,oe,P,{})}}const se="modulepreload",D={},ce="/peer-share/",le=function(e,o){return!o||o.length===0?e():Promise.all(o.map(r=>{if(r=`${ce}${r}`,r in D)return;D[r]=!0;const n=r.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${i}`))return;const t=document.createElement("link");if(t.rel=n?"stylesheet":se,n||(t.as="script",t.crossOrigin=""),t.href=r,document.head.appendChild(t),n)return new Promise((c,l)=>{t.addEventListener("load",c),t.addEventListener("error",l)})})).then(()=>e())};async function ae(){if(!window.WritableStream){const s=await le(()=>import("./ponyfill.es2018.3a0cf7e4.js"),[]);for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&(window[e]=s[e])}}function fe(){window.app=new re({target:document.body})}ae().then(fe);
