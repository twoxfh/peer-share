var ue=Object.defineProperty;var fe=(n,e,t)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var z=(n,e,t)=>(fe(n,typeof e!="symbol"?e+"":e,t),t);import{S as I,i as Y,s as D,e as p,t as q,a as g,b as _,c as M,d as c,f as V,l as S,g as F,n as A,h as E,r as X,w as de,j as pe,k as $,m as he,o as me,p as x,q as ee,u as _e,v as C,x as R,y as te,z as ve,A as ne,P as we,B as ge,C as be,D as oe}from"./vendor.35b18366.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}};ke();function ye(n){let e,t,s,r,o,i,a,l,f,u,h,v,d,k,P,m,y;return{c(){e=p("div"),t=p("div"),s=q("Your peer id is "),r=q(n[0]),o=g(),i=p("div"),a=p("a"),l=q("Share this link to others to connect"),u=g(),h=p("label"),v=q("Connect to "),d=p("input"),k=g(),P=p("button"),P.textContent="Connect",_(a,"href",f="#"+n[0]),_(a,"target","_blank"),_(d,"type","text"),_(e,"class","container")},m(w,b){M(w,e,b),c(e,t),c(t,s),c(t,r),c(e,o),c(e,i),c(i,a),c(a,l),c(e,u),c(e,h),c(h,v),c(h,d),V(d,n[1]),c(e,k),c(e,P),m||(y=[S(d,"input",n[5]),S(P,"click",n[6])],m=!0)},p(w,[b]){b&1&&F(r,w[0]),b&1&&f!==(f="#"+w[0])&&_(a,"href",f),b&2&&d.value!==w[1]&&V(d,w[1])},i:A,o:A,d(w){w&&E(e),m=!1,X(y)}}}function Be(n,e,t){let{id:s}=e,{peer:r}=e,{connection:o}=e,i="";function a(u){u&&t(1,i=u);let h=r.connect(i,{reliable:!0,serialization:"binary"});h.on("open",()=>t(3,o=h)),history.replaceState(null,document.title,window.location.pathname)}if(window.location.hash){const u=window.location.hash.substring(1);u&&a(u)}function l(){i=this.value,t(1,i)}const f=()=>a();return n.$$set=u=>{"id"in u&&t(0,s=u.id),"peer"in u&&t(4,r=u.peer),"connection"in u&&t(3,o=u.connection)},[s,i,a,o,r,l,f]}class qe extends I{constructor(e){super();Y(this,e,Be,ye,D,{id:0,peer:4,connection:3})}}const G=de(5*1024*1024);let se=5*1024*1024;G.subscribe(n=>se=n);async function Ce(n,e){const t=e;return e+=se,e>=n.size&&(e=n.size),{chunkFrom:e,value:await n.slice(t,e).arrayBuffer()}}async function*Pe(n){for(let e=0;e<n.size;){const{value:t,chunkFrom:s}=await Ce(n,e);e=s,yield t}}let ie=Promise.resolve();async function le(){await ie;let n={};return ie=n.promise=new Promise(e=>n.releaseLock=e),n}function Le(n,e){const t=document.createElement("a");t.hidden=!0;const s=URL.createObjectURL(e);t.href=s,t.download=n,document.body.append(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(s))}function ze(n){const e=[];return new Promise(async t=>{const s=n.getReader();for(;;){const{value:r,done:o}=await s.read();if(o){t(new Blob(e));return}e.push(new Blob([r]))}})}function H(n,e=!1,t=1){const s=e?1e3:1024;if(Math.abs(n)<s)return n+" B";const r=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const i=10**t;do n/=s,++o;while(Math.round(Math.abs(n)*i)/i>=s&&o<r.length-1);return n.toFixed(t)+" "+r[o]}class Me{constructor(e,t=s=>{}){z(this,"reqres");z(this,"requestCancel");z(this,"streamPull");this.connection=e,this.progressHandler=t,e.on("close",()=>this.requestCancel=!0),this.reqres=new Se(e,this.requestHandler.bind(this)),this.streamPull=null,this.requestCancel=!1}cancel(e){this.streamPull?this.requestCancel=!0:e||this.reqres.request("stream-cancel")}async requestHandler(e){if(e==="stream-pull"){if(!this.streamPull)throw new Error("Currently not streaming");return await this.streamPull(this.requestCancel)}else{if(e==="stream-cancel")return this.cancel(!0),"canceled";if(e.filename){const{filename:t,size:s}=e;if(!confirm(`Do you want to download
`+t))return"canceled";const r=this;let o=0;const i=new ReadableStream({async pull(a){const l=await r.reqres.request("stream-pull");l==="stop"?a.close():l==="canceled"?a.error():(a.enqueue(new Uint8Array(l)),o+=l.byteLength,r.progressHandler({loaded:o,total:s}))}});return ze(i).then(a=>Le(t,a)),"accepted"}}}sendFile(e){return new Promise(async t=>{if(this.streamPull)throw new Error("Already streaming another file");const s=await this.reqres.request({filename:e.name,size:e.size});let r=0;if(s==="accepted"){const o=Pe(e);this.streamPull=async i=>{if(i)return this.requestCancel=!1,this.streamPull=null,t(),"canceled";const{value:a,done:l}=await o.next();if(a)return r+=a.byteLength,this.progressHandler({loaded:r,total:e.size}),a;if(l)return this.streamPull=null,t(),"stop";throw new Error("No value got")}}})}}class Se{constructor(e,t){z(this,"connection");z(this,"resolver");z(this,"request");this.connection=e,this.resolver=null,this.connection.on("data",async s=>{if(s.response&&this.resolver(s.message),s.request){const r=await le(),o=await t(s.message);this.connection.send({response:!0,message:o}),r.releaseLock()}}),this.request=async s=>{const r=await le();return new Promise(o=>{this.connection.send({request:!0,message:s}),this.resolver=i=>{r.releaseLock(),o(i)}})}}}function Ee(n){let e,t,s,r,o,i,a,l,f,u,h,v,d,k,P,m,y,w,b=H(n[1])+"",T,K,N=H(n[2])+"",U,W,Z,J,O,j,Q;return{c(){e=p("div"),t=p("div"),s=p("input"),r=g(),o=p("button"),o.textContent="Send",i=g(),a=p("div"),l=p("label"),f=q("Chunk Size : "),u=p("select"),h=p("option"),h.textContent="1MB",v=p("option"),v.textContent="5MB",d=p("option"),d.textContent="10MB",k=p("option"),k.textContent="25MB",P=g(),m=p("div"),y=p("progress"),w=g(),T=q(b),K=q(" of "),U=q(N),W=g(),Z=p("br"),J=g(),O=p("button"),O.textContent="Cancel",_(s,"type","file"),s.multiple=!0,_(t,"class","svelte-hiwvhv"),h.__value=1*1024*1024,h.value=h.__value,v.__value=5*1024*1024,v.value=v.__value,d.__value=10*1024*1024,d.value=d.__value,k.__value=25*1024*1024,k.value=k.__value,n[3]===void 0&&pe(()=>n[8].call(u)),_(a,"class","svelte-hiwvhv"),y.value=n[1],_(y,"max",n[2]),_(m,"class","svelte-hiwvhv"),_(e,"class","container svelte-hiwvhv")},m(B,L){M(B,e,L),c(e,t),c(t,s),c(t,r),c(t,o),c(e,i),c(e,a),c(a,l),c(l,f),c(l,u),c(u,h),c(u,v),c(u,d),c(u,k),$(u,n[3]),c(e,P),c(e,m),c(m,y),c(m,w),c(m,T),c(m,K),c(m,U),c(m,W),c(m,Z),c(m,J),c(m,O),j||(Q=[S(s,"change",n[7]),S(o,"click",n[5]),S(u,"change",n[8]),S(O,"click",n[9])],j=!0)},p(B,[L]){L&8&&$(u,B[3]),L&2&&(y.value=B[1]),L&4&&_(y,"max",B[2]),L&2&&b!==(b=H(B[1])+"")&&F(T,b),L&4&&N!==(N=H(B[2])+"")&&F(U,N)},i:A,o:A,d(B){B&&E(e),j=!1,X(Q)}}}function Re(n,e,t){let s;he(n,G,d=>t(3,s=d));let{connection:r}=e,o,i=0,a=100;const l=new Me(r,d=>t(1,{loaded:i,total:a}=d,i,t(2,a)));async function f(){for(let d of o)await l.sendFile(d)}function u(){o=this.files,t(0,o)}function h(){s=me(this),G.set(s)}const v=()=>l.cancel();return n.$$set=d=>{"connection"in d&&t(6,r=d.connection)},[o,i,a,s,l,f,r,u,h,v]}class Ne extends I{constructor(e){super();Y(this,e,Re,Ee,D,{connection:6})}}function re(n){let e,t,s;function r(i){n[4](i)}let o={peer:n[1],id:n[2]};return n[0]!==void 0&&(o.connection=n[0]),e=new qe({props:o}),ge.push(()=>be(e,"connection",r)),{c(){x(e.$$.fragment)},m(i,a){ee(e,i,a),s=!0},p(i,a){const l={};a&2&&(l.peer=i[1]),a&4&&(l.id=i[2]),!t&&a&1&&(t=!0,l.connection=i[0],_e(()=>t=!1)),e.$set(l)},i(i){s||(C(e.$$.fragment,i),s=!0)},o(i){R(e.$$.fragment,i),s=!1},d(i){te(e,i)}}}function ae(n){let e,t;return e=new Ne({props:{connection:n[0]}}),{c(){x(e.$$.fragment)},m(s,r){ee(e,s,r),t=!0},p(s,r){const o={};r&1&&(o.connection=s[0]),e.$set(o)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){R(e.$$.fragment,s),t=!1},d(s){te(e,s)}}}function ce(n){let e;return{c(){e=p("div"),e.textContent="Peer to Peer Connection to remote person is closed"},m(t,s){M(t,e,s)},d(t){t&&E(e)}}}function Oe(n){let e,t,s,r,o=!n[0]&&n[2]&&re(n),i=n[0]&&!n[3]&&ae(n),a=n[3]&&ce();return{c(){o&&o.c(),e=g(),i&&i.c(),t=g(),a&&a.c(),s=ve()},m(l,f){o&&o.m(l,f),M(l,e,f),i&&i.m(l,f),M(l,t,f),a&&a.m(l,f),M(l,s,f),r=!0},p(l,[f]){!l[0]&&l[2]?o?(o.p(l,f),f&5&&C(o,1)):(o=re(l),o.c(),C(o,1),o.m(e.parentNode,e)):o&&(oe(),R(o,1,1,()=>{o=null}),ne()),l[0]&&!l[3]?i?(i.p(l,f),f&9&&C(i,1)):(i=ae(l),i.c(),C(i,1),i.m(t.parentNode,t)):i&&(oe(),R(i,1,1,()=>{i=null}),ne()),l[3]?a||(a=ce(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i(l){r||(C(o),C(i),r=!0)},o(l){R(o),R(i),r=!1},d(l){o&&o.d(l),l&&E(e),i&&i.d(l),l&&E(t),a&&a.d(l),l&&E(s)}}}function Ae(n,e,t){let s;s=new we;let r="";s.on("open",l=>console.log(t(2,r=l)));let o=null,i=!1;s.on("connection",l=>l.on("open",()=>t(0,o=l))),window.addEventListener("beforeunload",l=>{o&&o.close(),s.destroy()}),s.on("error",l=>console.error(l));function a(l){o=l,t(0,o)}return n.$$.update=()=>{n.$$.dirty&1&&o&&o.on("close",()=>t(3,i=!0))},[o,s,r,i,a]}class He extends I{constructor(e){super();Y(this,e,Ae,Oe,D,{})}}window.app=new He({target:document.body});
