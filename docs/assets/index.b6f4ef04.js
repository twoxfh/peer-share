var ue=Object.defineProperty;var fe=(n,e,t)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var z=(n,e,t)=>(fe(n,typeof e!="symbol"?e+"":e,t),t);import{S as I,i as Y,s as D,e as p,t as C,a as b,b as _,c as M,d as c,f as V,l as S,g as F,n as A,h as E,r as X,w as de,j as pe,k as $,m as he,o as me,p as x,q as ee,u as _e,v as B,x as R,y as te,z as ve,A as ne,P as we,B as be,C as ge,D as oe}from"./vendor.35b18366.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}};ke();function ye(n){let e,t,s,r,o,i,a,l,u,f,h,v,d,k,P,m,y;return{c(){e=p("div"),t=p("div"),s=C("Your peer id is "),r=C(n[0]),o=b(),i=p("div"),a=p("a"),l=C("Share this link to others to connect"),f=b(),h=p("label"),v=C("Connect to "),d=p("input"),k=b(),P=p("button"),P.textContent="Connect",_(a,"href",u="#"+n[0]),_(a,"target","_blank"),_(d,"type","text"),_(e,"class","container")},m(w,g){M(w,e,g),c(e,t),c(t,s),c(t,r),c(e,o),c(e,i),c(i,a),c(a,l),c(e,f),c(e,h),c(h,v),c(h,d),V(d,n[1]),c(e,k),c(e,P),m||(y=[S(d,"input",n[5]),S(P,"click",n[6])],m=!0)},p(w,[g]){g&1&&F(r,w[0]),g&1&&u!==(u="#"+w[0])&&_(a,"href",u),g&2&&d.value!==w[1]&&V(d,w[1])},i:A,o:A,d(w){w&&E(e),m=!1,X(y)}}}function qe(n,e,t){let{id:s}=e,{peer:r}=e,{connection:o}=e,i="";function a(f){f&&t(1,i=f);let h=r.connect(i,{reliable:!0,serialization:"binary"});h.on("open",()=>t(3,o=h)),history.replaceState(null,document.title,window.location.pathname)}if(window.location.hash){const f=window.location.hash.substring(1);f&&a(f)}function l(){i=this.value,t(1,i)}const u=()=>a();return n.$$set=f=>{"id"in f&&t(0,s=f.id),"peer"in f&&t(4,r=f.peer),"connection"in f&&t(3,o=f.connection)},[s,i,a,o,r,l,u]}class Ce extends I{constructor(e){super();Y(this,e,qe,ye,D,{id:0,peer:4,connection:3})}}const G=de(5*1024*1024);let se=5*1024*1024;G.subscribe(n=>se=n);async function Be(n,e){const t=e;return e+=se,e>=n.size&&(e=n.size),{chunkFrom:e,value:await n.slice(t,e).arrayBuffer()}}async function*Pe(n){for(let e=0;e<n.size;){const{value:t,chunkFrom:s}=await Be(n,e);e=s,yield t}}let ie=Promise.resolve();async function le(){await ie;let n={};return ie=n.promise=new Promise(e=>n.releaseLock=e),n}function Le(n,e){const t=document.createElement("a");t.hidden=!0;const s=URL.createObjectURL(e);t.href=s,t.download=n,document.body.append(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(s))}function H(n,e=!1,t=1){const s=e?1e3:1024;if(Math.abs(n)<s)return n+" B";const r=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const i=10**t;do n/=s,++o;while(Math.round(Math.abs(n)*i)/i>=s&&o<r.length-1);return n.toFixed(t)+" "+r[o]}class ze{constructor(e,t=s=>{}){z(this,"reqres");z(this,"requestCancel");z(this,"streamPull");this.connection=e,this.progressHandler=t,e.on("close",()=>this.requestCancel=!0),this.reqres=new Me(e,this.requestHandler.bind(this)),this.streamPull=null,this.requestCancel=!1}cancel(e){this.streamPull?this.requestCancel=!0:e||this.reqres.request("stream-cancel")}async requestHandler(e){if(e==="stream-pull"){if(!this.streamPull)throw new Error("Currently not streaming");return await this.streamPull(this.requestCancel)}else{if(e==="stream-cancel")return this.cancel(!0),"canceled";if(e.filename){const{filename:t,size:s}=e;if(!confirm(`Do you want to download
`+t))return"canceled";const r=this;let o=0;const i=new ReadableStream({async pull(l){const u=await r.reqres.request("stream-pull");u==="stop"?l.close():u==="canceled"?l.error():(l.enqueue(new Uint8Array(u)),o+=u.byteLength,r.progressHandler({loaded:o,total:s}))}});return new Response(i).blob().then(l=>Le(t,l)),"accepted"}}}sendFile(e){return new Promise(async t=>{if(this.streamPull)throw new Error("Already streaming another file");const s=await this.reqres.request({filename:e.name,size:e.size});let r=0;if(s==="accepted"){const o=Pe(e);this.streamPull=async i=>{if(i)return this.requestCancel=!1,this.streamPull=null,t(),"canceled";const{value:a,done:l}=await o.next();if(a)return r+=a.byteLength,this.progressHandler({loaded:r,total:e.size}),a;if(l)return this.streamPull=null,t(),"stop";throw new Error("No value got")}}})}}class Me{constructor(e,t){z(this,"connection");z(this,"resolver");z(this,"request");this.connection=e,this.resolver=null,this.connection.on("data",async s=>{if(s.response&&this.resolver(s.message),s.request){const r=await le(),o=await t(s.message);this.connection.send({response:!0,message:o}),r.releaseLock()}}),this.request=async s=>{const r=await le();return new Promise(o=>{this.connection.send({request:!0,message:s}),this.resolver=i=>{r.releaseLock(),o(i)}})}}}function Se(n){let e,t,s,r,o,i,a,l,u,f,h,v,d,k,P,m,y,w,g=H(n[1])+"",U,K,N=H(n[2])+"",j,W,Z,J,O,T,Q;return{c(){e=p("div"),t=p("div"),s=p("input"),r=b(),o=p("button"),o.textContent="Send",i=b(),a=p("div"),l=p("label"),u=C("Chunk Size : "),f=p("select"),h=p("option"),h.textContent="1MB",v=p("option"),v.textContent="5MB",d=p("option"),d.textContent="10MB",k=p("option"),k.textContent="25MB",P=b(),m=p("div"),y=p("progress"),w=b(),U=C(g),K=C(" of "),j=C(N),W=b(),Z=p("br"),J=b(),O=p("button"),O.textContent="Cancel",_(s,"type","file"),s.multiple=!0,_(t,"class","svelte-hiwvhv"),h.__value=1*1024*1024,h.value=h.__value,v.__value=5*1024*1024,v.value=v.__value,d.__value=10*1024*1024,d.value=d.__value,k.__value=25*1024*1024,k.value=k.__value,n[3]===void 0&&pe(()=>n[8].call(f)),_(a,"class","svelte-hiwvhv"),y.value=n[1],_(y,"max",n[2]),_(m,"class","svelte-hiwvhv"),_(e,"class","container svelte-hiwvhv")},m(q,L){M(q,e,L),c(e,t),c(t,s),c(t,r),c(t,o),c(e,i),c(e,a),c(a,l),c(l,u),c(l,f),c(f,h),c(f,v),c(f,d),c(f,k),$(f,n[3]),c(e,P),c(e,m),c(m,y),c(m,w),c(m,U),c(m,K),c(m,j),c(m,W),c(m,Z),c(m,J),c(m,O),T||(Q=[S(s,"change",n[7]),S(o,"click",n[5]),S(f,"change",n[8]),S(O,"click",n[9])],T=!0)},p(q,[L]){L&8&&$(f,q[3]),L&2&&(y.value=q[1]),L&4&&_(y,"max",q[2]),L&2&&g!==(g=H(q[1])+"")&&F(U,g),L&4&&N!==(N=H(q[2])+"")&&F(j,N)},i:A,o:A,d(q){q&&E(e),T=!1,X(Q)}}}function Ee(n,e,t){let s;he(n,G,d=>t(3,s=d));let{connection:r}=e,o,i=0,a=100;const l=new ze(r,d=>t(1,{loaded:i,total:a}=d,i,t(2,a)));async function u(){for(let d of o)await l.sendFile(d)}function f(){o=this.files,t(0,o)}function h(){s=me(this),G.set(s)}const v=()=>l.cancel();return n.$$set=d=>{"connection"in d&&t(6,r=d.connection)},[o,i,a,s,l,u,r,f,h,v]}class Re extends I{constructor(e){super();Y(this,e,Ee,Se,D,{connection:6})}}function re(n){let e,t,s;function r(i){n[4](i)}let o={peer:n[1],id:n[2]};return n[0]!==void 0&&(o.connection=n[0]),e=new Ce({props:o}),be.push(()=>ge(e,"connection",r)),{c(){x(e.$$.fragment)},m(i,a){ee(e,i,a),s=!0},p(i,a){const l={};a&2&&(l.peer=i[1]),a&4&&(l.id=i[2]),!t&&a&1&&(t=!0,l.connection=i[0],_e(()=>t=!1)),e.$set(l)},i(i){s||(B(e.$$.fragment,i),s=!0)},o(i){R(e.$$.fragment,i),s=!1},d(i){te(e,i)}}}function ae(n){let e,t;return e=new Re({props:{connection:n[0]}}),{c(){x(e.$$.fragment)},m(s,r){ee(e,s,r),t=!0},p(s,r){const o={};r&1&&(o.connection=s[0]),e.$set(o)},i(s){t||(B(e.$$.fragment,s),t=!0)},o(s){R(e.$$.fragment,s),t=!1},d(s){te(e,s)}}}function ce(n){let e;return{c(){e=p("div"),e.textContent="Peer to Peer Connection to remote person is closed"},m(t,s){M(t,e,s)},d(t){t&&E(e)}}}function Ne(n){let e,t,s,r,o=!n[0]&&n[2]&&re(n),i=n[0]&&!n[3]&&ae(n),a=n[3]&&ce();return{c(){o&&o.c(),e=b(),i&&i.c(),t=b(),a&&a.c(),s=ve()},m(l,u){o&&o.m(l,u),M(l,e,u),i&&i.m(l,u),M(l,t,u),a&&a.m(l,u),M(l,s,u),r=!0},p(l,[u]){!l[0]&&l[2]?o?(o.p(l,u),u&5&&B(o,1)):(o=re(l),o.c(),B(o,1),o.m(e.parentNode,e)):o&&(oe(),R(o,1,1,()=>{o=null}),ne()),l[0]&&!l[3]?i?(i.p(l,u),u&9&&B(i,1)):(i=ae(l),i.c(),B(i,1),i.m(t.parentNode,t)):i&&(oe(),R(i,1,1,()=>{i=null}),ne()),l[3]?a||(a=ce(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i(l){r||(B(o),B(i),r=!0)},o(l){R(o),R(i),r=!1},d(l){o&&o.d(l),l&&E(e),i&&i.d(l),l&&E(t),a&&a.d(l),l&&E(s)}}}function Oe(n,e,t){let s;s=new we;let r="";s.on("open",l=>console.log(t(2,r=l)));let o=null,i=!1;s.on("connection",l=>l.on("open",()=>t(0,o=l))),window.addEventListener("beforeunload",l=>{o&&o.close(),s.destroy()}),s.on("error",l=>console.error(l));function a(l){o=l,t(0,o)}return n.$$.update=()=>{n.$$.dirty&1&&o&&o.on("close",()=>t(3,i=!0))},[o,s,r,i,a]}class Ae extends I{constructor(e){super();Y(this,e,Oe,Ne,D,{})}}window.app=new Ae({target:document.body});
